/**************************************************
 * 用于向服务器发送post请求
 *
 **************************************************/
var querystring = require('querystring'),
     http = require('http'),
     framework = require('framework'),
     urlp = require('url');
var  log4js = require('log4js-node');

var postobj=function(){
    log4js.configure(framework.Configuration.log4jsCfg);
    this.logger = log4js.getLogger('');
}

module.exports =new postobj();
/**
 * http.post
 * @param url 需要post到的地址
 * @param data post的数据
 * @param callback  回掉函数
 */
postobj.prototype.post=function(url,data,callback){
    var self=this;
    self.data=data;
    self.options = urlp.parse(url);
    self.options.method='POST';
    self.result="";
    self.options.headers={
        'Content-Length':self.data.length,
        'Content-Type':"application/x-www-form-urlencoded",
    };
    var req = http.request(self.options, function(res) {
        res.setEncoding('utf8');
        res.on('data', function (result) {
            self.result=self.result+result;
        }).on('end',function(){
            self.result=eval('('+self.result+')');
            callback(self.result);
        });
    });
    req.on('error', function(e) {
        console.log('problem with request: ' + e.message);
    });
    req.write(self.data+'\n');
    self.logger.debug(self.data);
    req.end();
};